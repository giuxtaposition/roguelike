var X=Object.defineProperty;var Y=(t,e,n)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>(Y(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();function d(){}function W(t){return t()}function j(){return Object.create(null)}function P(t){t.forEach(W)}function F(t){return typeof t=="function"}function R(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Z(t){return Object.keys(t).length===0}function B(t,e,n){t.insertBefore(e,n||null)}function A(t){t.parentNode&&t.parentNode.removeChild(t)}function G(t){return document.createElement(t)}function ee(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function te(t){return function(e){return e.preventDefault(),t.call(this,e)}}function ne(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function se(t){return Array.from(t.childNodes)}let w;function T(t){w=t}function re(){if(!w)throw new Error("Function called outside component initialization");return w}function ie(t){re().$$.on_mount.push(t)}const y=[],k=[],x=[],z=[],le=Promise.resolve();let L=!1;function oe(){L||(L=!0,le.then(H))}function O(t){x.push(t)}const S=new Set;let p=0;function H(){if(p!==0)return;const t=w;do{try{for(;p<y.length;){const e=y[p];p++,T(e),ue(e.$$)}}catch(e){throw y.length=0,p=0,e}for(T(null),y.length=0,p=0;k.length;)k.pop()();for(let e=0;e<x.length;e+=1){const n=x[e];S.has(n)||(S.add(n),n())}x.length=0}while(y.length);for(;z.length;)z.pop()();L=!1,S.clear(),T(t)}function ue(t){if(t.fragment!==null){t.update(),P(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(O)}}const E=new Set;let ae;function U(t,e){t&&t.i&&(E.delete(t),t.i(e))}function ce(t,e,n,s){if(t&&t.o){if(E.has(t))return;E.add(t),ae.c.push(()=>{E.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}else s&&s()}function fe(t){t&&t.c()}function K(t,e,n,s){const{fragment:r,after_update:l}=t.$$;r&&r.m(e,n),s||O(()=>{const i=t.$$.on_mount.map(W).filter(F);t.$$.on_destroy?t.$$.on_destroy.push(...i):P(i),t.$$.on_mount=[]}),l.forEach(O)}function q(t,e){const n=t.$$;n.fragment!==null&&(P(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function he(t,e){t.$$.dirty[0]===-1&&(y.push(t),oe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(t,e,n,s,r,l,i,N=[-1]){const m=w;T(t);const u=t.$$={fragment:null,ctx:[],props:l,update:d,not_equal:r,bound:j(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(m?m.$$.context:[])),callbacks:j(),dirty:N,skip_bound:!1,root:e.target||m.$$.root};i&&i(u.root);let v=!1;if(u.ctx=n?n(t,e.props||{},(c,g,...$)=>{const o=$.length?$[0]:g;return u.ctx&&r(u.ctx[c],u.ctx[c]=o)&&(!u.skip_bound&&u.bound[c]&&u.bound[c](o),v&&he(t,c)),g}):[],u.update(),v=!0,P(u.before_update),u.fragment=s?s(u.ctx):!1,e.target){if(e.hydrate){const c=se(e.target);u.fragment&&u.fragment.l(c),c.forEach(A)}else u.fragment&&u.fragment.c();e.intro&&U(t.$$.fragment),K(t,e.target,e.anchor,e.customElement),H()}T(m)}class J{$destroy(){q(this,1),this.$destroy=d}$on(e,n){if(!F(n))return d;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const r=s.indexOf(n);r!==-1&&s.splice(r,1)}}$set(e){this.$$set&&!Z(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function C(t,e){for(let n=1e3;n>0;n--)if(e())return;throw"Timeout while trying to "+t}function M(t,e){return Math.floor(Math.random()*(e-t+1))+t}function Q(t){let e,n;for(let s=1;s<t.length;s++)n=M(0,s),e=t[s],t[s]=t[n],t[n]=e;return t}class _{constructor(e,n,s){a(this,"tile");a(this,"sprite");a(this,"health");a(this,"isPlayer",!1);this.move(e),this.sprite=n,this.health=s}tryToMove(e,n){let s=this.tile.getNeighbor(e,n);if(s.passable)return s.entity||this.move(s),!0}move(e){this.tile&&(this.tile.entity=null),this.tile=e,e.entity=this}}class de extends _{constructor(e){super(e,0,3),this.isPlayer=!0}}class me extends _{constructor(e){super(e,4,3)}}class ge extends _{constructor(e){super(e,5,1)}}class pe extends _{constructor(e){super(e,6,2)}}class ye extends _{constructor(e){super(e,7,1)}}class _e extends _{constructor(e){super(e,8,3)}}class V{constructor(e,n,s,r,l){a(this,"x");a(this,"y");a(this,"sprite");a(this,"passable");a(this,"game");a(this,"entity");this.x=e,this.y=n,this.sprite=s,this.passable=r,this.game=l}getConnectedTiles(){let e=[this],n=[this];for(;n.length;){let s=n.pop().getAdjacentPassableNeighbors().filter(r=>!e.includes(r));e=e.concat(s),n=n.concat(s)}return e}getNeighbor(e,n){return this.game.getTile(this.x+e,this.y+n)}getAdjacentNeighbors(){return Q([this.getNeighbor(0,-1),this.getNeighbor(0,1),this.getNeighbor(-1,0),this.getNeighbor(1,0)])}getAdjacentPassableNeighbors(){return this.getAdjacentNeighbors().filter(e=>e.passable)}}class be extends V{constructor(e,n,s){super(e,n,2,!0,s)}}class I extends V{constructor(e,n,s){super(e,n,3,!1,s)}}class Te{constructor(){a(this,"tileSize",64);a(this,"numTiles",9);a(this,"uiWidth",4);a(this,"level",1);a(this,"tiles",[]);a(this,"enemies",[]);a(this,"player");this.generateLevel(),this.player=new de(this.randomPassableTile())}getTile(e,n){return this.inBounds(e,n)?this.tiles[e][n]:new I(e,n,this)}movePlayer(e){switch(e){case h.UP:this.player.tryToMove(0,-1);break;case h.DOWN:this.player.tryToMove(0,1);break;case h.LEFT:this.player.tryToMove(-1,0);break;case h.RIGHT:this.player.tryToMove(1,0);break}}generateLevel(){C("generate map",()=>this.generateTiles()==this.randomPassableTile().getConnectedTiles().length),this.generateEnemies()}generateTiles(){let e=0;for(let n=0;n<this.numTiles;n++){this.tiles[n]=[];for(let s=0;s<this.numTiles;s++)Math.random()<.3||!this.inBounds(n,s)?this.tiles[n][s]=new I(n,s,this):(this.tiles[n][s]=new be(n,s,this),e++)}return e}generateEnemies(){let e=this.level+1;for(let n=0;n<e;n++)this.spawnEnemies()}spawnEnemies(){let e=Q([me,ge,pe,ye,_e])[0];this.enemies.push(new e(this.randomPassableTile()))}inBounds(e,n){return e>0&&n>0&&e<this.numTiles-1&&n<this.numTiles-1}randomPassableTile(){let e;return C("get random passable tile",()=>{let n=M(0,this.numTiles-1),s=M(0,this.numTiles-1);return e=this.getTile(n,s),e.passable}),e}}var h=(t=>(t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t))(h||{});function we(t){let e,n,s;return{c(){e=G("canvas"),ne(e,"class","svelte-3f2pl5")},m(r,l){B(r,e,l),t[2](e),n||(s=ee(window,"keydown",te(t[1])),n=!0)},p:d,i:d,o:d,d(r){r&&A(e),t[2](null),n=!1,s()}}}function ve(t,e,n){let s,r;const l=new Image;l.src="spritesheet.png";const i=new Te;function N(o){o.key=="w"&&i.movePlayer(h.UP),o.key=="s"&&i.movePlayer(h.DOWN),o.key=="a"&&i.movePlayer(h.LEFT),o.key=="d"&&i.movePlayer(h.RIGHT)}function m(){r.clearRect(0,0,s.width,s.height),c(),v(),u()}function u(){for(let o=0;o<i.enemies.length;o++){const f=i.enemies[o];g(f.sprite,f.tile.x,f.tile.y)}}function v(){g(i.player.sprite,i.player.tile.x,i.player.tile.y)}function c(){for(let o=0;o<i.numTiles;o++)for(let f=0;f<i.numTiles;f++){const b=i.getTile(o,f);g(b.sprite,b.x,b.y)}}function g(o,f,b){r.drawImage(l,o*16,0,16,16,f*i.tileSize,b*i.tileSize,i.tileSize,i.tileSize)}ie(()=>{r=s.getContext("2d"),n(0,s.width=i.tileSize*(i.numTiles+i.uiWidth),s),n(0,s.height=i.tileSize*i.numTiles,s),n(0,s.style.width=s.width+"px",s),n(0,s.style.height=s.height+"px",s),r.imageSmoothingEnabled=!1});function $(o){k[o?"unshift":"push"](()=>{s=o,n(0,s)})}return setInterval(m,15),[s,N,$]}class $e extends J{constructor(e){super(),D(this,e,ve,we,R,{})}}function xe(t){let e,n,s;return n=new $e({}),{c(){e=G("main"),fe(n.$$.fragment)},m(r,l){B(r,e,l),K(n,e,null),s=!0},p:d,i(r){s||(U(n.$$.fragment,r),s=!0)},o(r){ce(n.$$.fragment,r),s=!1},d(r){r&&A(e),q(n)}}}class Ee extends J{constructor(e){super(),D(this,e,null,xe,R,{})}}new Ee({target:document.body});
