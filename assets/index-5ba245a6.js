var Q=Object.defineProperty;var V=(e,t,n)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var a=(e,t,n)=>(V(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function d(){}function I(e){return e()}function M(){return Object.create(null)}function x(e){e.forEach(I)}function C(e){return typeof e=="function"}function F(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function X(e){return Object.keys(e).length===0}function W(e,t,n){e.insertBefore(t,n||null)}function A(e){e.parentNode&&e.parentNode.removeChild(e)}function R(e){return document.createElement(e)}function Y(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function Z(e){return function(t){return t.preventDefault(),e.call(this,t)}}function D(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ee(e){return Array.from(e.childNodes)}let b;function _(e){b=e}function te(){if(!b)throw new Error("Function called outside component initialization");return b}function ne(e){te().$$.on_mount.push(e)}const p=[],E=[],v=[],O=[],re=Promise.resolve();let L=!1;function ie(){L||(L=!0,re.then(G))}function S(e){v.push(e)}const N=new Set;let m=0;function G(){if(m!==0)return;const e=b;do{try{for(;m<p.length;){const t=p[m];m++,_(t),se(t.$$)}}catch(t){throw p.length=0,m=0,t}for(_(null),p.length=0,m=0;E.length;)E.pop()();for(let t=0;t<v.length;t+=1){const n=v[t];N.has(n)||(N.add(n),n())}v.length=0}while(p.length);for(;O.length;)O.pop()();L=!1,N.clear(),_(e)}function se(e){if(e.fragment!==null){e.update(),x(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(S)}}const $=new Set;let oe;function B(e,t){e&&e.i&&($.delete(e),e.i(t))}function le(e,t,n,r){if(e&&e.o){if($.has(e))return;$.add(e),oe.c.push(()=>{$.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function ue(e){e&&e.c()}function H(e,t,n,r){const{fragment:i,after_update:o}=e.$$;i&&i.m(t,n),r||S(()=>{const s=e.$$.on_mount.map(I).filter(C);e.$$.on_destroy?e.$$.on_destroy.push(...s):x(s),e.$$.on_mount=[]}),o.forEach(S)}function U(e,t){const n=e.$$;n.fragment!==null&&(x(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ae(e,t){e.$$.dirty[0]===-1&&(p.push(e),ie(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function K(e,t,n,r,i,o,s,P=[-1]){const g=b;_(e);const l=e.$$={fragment:null,ctx:[],props:o,update:d,not_equal:i,bound:M(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(g?g.$$.context:[])),callbacks:M(),dirty:P,skip_bound:!1,root:t.target||g.$$.root};s&&s(l.root);let T=!1;if(l.ctx=n?n(e,t.props||{},(c,w,...u)=>{const h=u.length?u[0]:w;return l.ctx&&i(l.ctx[c],l.ctx[c]=h)&&(!l.skip_bound&&l.bound[c]&&l.bound[c](h),T&&ae(e,c)),w}):[],l.update(),T=!0,x(l.before_update),l.fragment=r?r(l.ctx):!1,t.target){if(t.hydrate){const c=ee(t.target);l.fragment&&l.fragment.l(c),c.forEach(A)}else l.fragment&&l.fragment.c();t.intro&&B(e.$$.fragment),H(e,t.target,t.anchor,t.customElement),G()}_(g)}class q{$destroy(){U(this,1),this.$destroy=d}$on(t,n){if(!C(n))return d;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!X(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function j(e,t){for(let n=1e3;n>0;n--)if(t())return;throw"Timeout while trying to "+e}function k(e,t){return Math.floor(Math.random()*(t-e+1))+e}function ce(e){let t,n;for(let r=1;r<e.length;r++)n=k(0,r),t=e[r],e[r]=e[n],e[n]=t;return e}class fe{constructor(t,n,r){a(this,"tile");a(this,"sprite");a(this,"health");a(this,"isPlayer");this.move(t),this.sprite=n,this.health=r}tryToMove(t,n){let r=this.tile.getNeighbor(t,n);if(r.passable)return r.entity||this.move(r),!0}move(t){this.tile&&(this.tile.entity=null),this.tile=t,t.entity=this}}class he extends fe{constructor(t){super(t,0,3),this.isPlayer=!0}}class J{constructor(t,n,r,i,o){a(this,"x");a(this,"y");a(this,"sprite");a(this,"passable");a(this,"game");a(this,"entity");this.x=t,this.y=n,this.sprite=r,this.passable=i,this.game=o}getConnectedTiles(){let t=[this],n=[this];for(;n.length;){let r=n.pop().getAdjacentPassableNeighbors().filter(i=>!t.includes(i));t=t.concat(r),n=n.concat(r)}return t}getNeighbor(t,n){return this.game.getTile(this.x+t,this.y+n)}getAdjacentNeighbors(){return ce([this.getNeighbor(0,-1),this.getNeighbor(0,1),this.getNeighbor(-1,0),this.getNeighbor(1,0)])}getAdjacentPassableNeighbors(){return this.getAdjacentNeighbors().filter(t=>t.passable)}}class de extends J{constructor(t,n,r){super(t,n,2,!0,r)}}class z extends J{constructor(t,n,r){super(t,n,3,!1,r)}}class ge{constructor(){a(this,"tileSize",64);a(this,"numTiles",9);a(this,"uiWidth",4);a(this,"player");a(this,"tiles",[]);this.generateLevel(),this.player=new he(this.randomPassableTile())}getTile(t,n){return this.inBounds(t,n)?this.tiles[t][n]:new z(t,n,this)}movePlayer(t){switch(t){case f.UP:this.player.tryToMove(0,-1);break;case f.DOWN:this.player.tryToMove(0,1);break;case f.LEFT:this.player.tryToMove(-1,0);break;case f.RIGHT:this.player.tryToMove(1,0);break}}generateLevel(){j("generate map",()=>this.generateTiles()==this.randomPassableTile().getConnectedTiles().length)}generateTiles(){let t=0;for(let n=0;n<this.numTiles;n++){this.tiles[n]=[];for(let r=0;r<this.numTiles;r++)Math.random()<.3||!this.inBounds(n,r)?this.tiles[n][r]=new z(n,r,this):(this.tiles[n][r]=new de(n,r,this),t++)}return t}inBounds(t,n){return t>0&&n>0&&t<this.numTiles-1&&n<this.numTiles-1}randomPassableTile(){let t;return j("get random passable tile",()=>{let n=k(0,this.numTiles-1),r=k(0,this.numTiles-1);return t=this.getTile(n,r),t.passable}),t}}var f=(e=>(e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT",e))(f||{});function me(e){let t,n,r;return{c(){t=R("canvas"),D(t,"class","svelte-3f2pl5")},m(i,o){W(i,t,o),e[2](t),n||(r=Y(window,"keydown",Z(e[1])),n=!0)},p:d,i:d,o:d,d(i){i&&A(t),e[2](null),n=!1,r()}}}function pe(e,t,n){let r,i;const o=new Image;o.src="spritesheet.png";const s=new ge;function P(u){u.key=="w"&&s.movePlayer(f.UP),u.key=="s"&&s.movePlayer(f.DOWN),u.key=="a"&&s.movePlayer(f.LEFT),u.key=="d"&&s.movePlayer(f.RIGHT)}function g(){i.clearRect(0,0,r.width,r.height),T(),l()}function l(){c(0,s.player.tile.x,s.player.tile.y)}function T(){for(let u=0;u<s.numTiles;u++)for(let h=0;h<s.numTiles;h++){const y=s.getTile(u,h);c(y.sprite,y.x,y.y)}}function c(u,h,y){i.drawImage(o,u*16,0,16,16,h*s.tileSize,y*s.tileSize,s.tileSize,s.tileSize)}ne(()=>{i=r.getContext("2d"),n(0,r.width=s.tileSize*(s.numTiles+s.uiWidth),r),n(0,r.height=s.tileSize*s.numTiles,r),n(0,r.style.width=r.width+"px",r),n(0,r.style.height=r.height+"px",r),i.imageSmoothingEnabled=!1});function w(u){E[u?"unshift":"push"](()=>{r=u,n(0,r)})}return setInterval(g,15),[r,P,w]}class ye extends q{constructor(t){super(),K(this,t,pe,me,F,{})}}function _e(e){let t,n,r;return n=new ye({}),{c(){t=R("main"),ue(n.$$.fragment)},m(i,o){W(i,t,o),H(n,t,null),r=!0},p:d,i(i){r||(B(n.$$.fragment,i),r=!0)},o(i){le(n.$$.fragment,i),r=!1},d(i){i&&A(t),U(n)}}}class be extends q{constructor(t){super(),K(this,t,null,_e,F,{})}}new be({target:document.body});
